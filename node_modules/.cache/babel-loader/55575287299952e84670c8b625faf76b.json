{"remainingRequest":"D:\\workFiles\\deployweb\\node_modules\\babel-loader\\lib\\index.js!D:\\workFiles\\deployweb\\node_modules\\cache-loader\\dist\\cjs.js??ref--0-0!D:\\workFiles\\deployweb\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\workFiles\\deployweb\\src\\components\\deploy\\DeployEdit.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\workFiles\\deployweb\\src\\components\\deploy\\DeployEdit.vue","mtime":1583747397519},{"path":"D:\\workFiles\\deployweb\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\workFiles\\deployweb\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"D:\\workFiles\\deployweb\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\workFiles\\deployweb\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["import \"core-js/modules/es6.function.name\";\nimport \"core-js/modules/es6.regexp.replace\";\nimport \"regenerator-runtime/runtime\";\nimport _asyncToGenerator from \"D:\\\\workFiles\\\\deployweb\\\\node_modules\\\\@babel\\\\runtime-corejs2/helpers/esm/asyncToGenerator\";\nimport \"core-js/modules/es6.regexp.split\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport '@ckeditor/ckeditor5-build-decoupled-document/build/translations/zh-cn';\nimport DecoupledEditor from '@ckeditor/ckeditor5-build-decoupled-document'; // import func from '../../../vue-temp/vue-editor-bridge';\n\nexport default {\n  props: ['categorys'],\n  data: function data() {\n    return {\n      editor: DecoupledEditor,\n      editorConfig: {\n        language: 'zh-cn',\n        fontSize: {\n          options: [8, 10, 'default', 14, 16, 18, 20, 22, 24, 26, 28, 32, 48]\n        },\n        fontFamily: {\n          options: ['宋体', '仿宋', '微软雅黑', '黑体', '仿宋_GB2312', '楷体', '隶书', '幼圆']\n        }\n      },\n      deployEditFlag: false,\n      deployEditId: '',\n      planForDeployId: '',\n      subHeader: '',\n      fileList: [],\n      DeployForm: {\n        title: '',\n        category_id: '',\n        version: '',\n        post_author: '',\n        deploy_links: '',\n        deploy_sql: '',\n        deploy_describe: '',\n        body: '',\n        environment_id: null,\n        fileNames: null\n      },\n      rules: {\n        title: [{\n          required: true,\n          message: '请输入部署标题',\n          trigger: 'blur'\n        }, {\n          min: 3,\n          max: 60,\n          message: '长度在 3 到 60 个字符',\n          trigger: 'blur'\n        }],\n        category_id: [{\n          required: true,\n          message: '请选择所属项目',\n          trigger: 'change'\n        }],\n        version: [{\n          required: true,\n          message: '请输入发布版本',\n          trigger: 'blur'\n        }, {\n          min: 3,\n          max: 60,\n          message: '长度在 3 到 60 个字符',\n          trigger: 'blur'\n        }],\n        deploy_describe: [{\n          required: true,\n          message: '请填写转测范围',\n          trigger: 'blur'\n        }],\n        deploy_links: [{\n          required: true,\n          message: '请填写部署包下载链接',\n          trigger: 'blur'\n        }],\n        environment_id: [{\n          required: true,\n          message: '请选择部署环境',\n          trigger: 'change'\n        }],\n        body: [{\n          required: true,\n          message: '请将测试报告复制到此处',\n          trigger: 'blur'\n        }]\n      },\n      environments: [{\n        value: 2,\n        label: 'yfb-uco'\n      }, {\n        value: 3,\n        label: 'UCA-LF'\n      }, {\n        value: 5,\n        label: 'UCA-TJ'\n      }, {\n        value: 6,\n        label: 'UCA-BJ'\n      }, {\n        value: 7,\n        label: 'CVM-TJ'\n      }, {\n        value: 8,\n        label: 'CVM-BJ'\n      }, {\n        value: 10,\n        label: 'CVM-LF'\n      }, {\n        value: 11,\n        label: 'CVK-TJ'\n      }, {\n        value: 13,\n        label: 'CVK-BJ'\n      }, {\n        value: 15,\n        label: 'CVK-LF'\n      }, {\n        value: 17,\n        label: 'VCFC-TJ'\n      }, {\n        value: 18,\n        label: 'VCFC-BJ'\n      }, {\n        value: 19,\n        label: 'VCFC-LF'\n      }]\n    };\n  },\n  mounted: function mounted() {\n    this.judgeCreateOrEdit();\n  },\n  methods: {\n    initDeployFormEdit: function initDeployFormEdit(id) {\n      var _this = this;\n\n      this.$axios.get(this.$api.deployManage + '/' + id).then(function (response) {\n        _this.DeployForm.title = response.data['res']['title'];\n        _this.DeployForm.category_id = response.data['res']['category_id'];\n        _this.DeployForm.version = response.data['res']['version'];\n        _this.DeployForm.post_author = response.data['res']['post_author'];\n        _this.DeployForm.environment_id = response.data['res']['environment_id'];\n        _this.DeployForm.deploy_links = response.data['res']['deploy_links'];\n        _this.DeployForm.deploy_sql = response.data['res']['deploy_sql'];\n        _this.DeployForm.deploy_describe = response.data['res']['deploy_describe'];\n        _this.DeployForm.body = response.data['res']['body'];\n        _this.DeployForm.fileNames = response.data['res']['report_file_names'];\n        _this.fileList = response.data['fileList'];\n      });\n    },\n    initDeployFormGoto: function initDeployFormGoto(id) {\n      var _this2 = this;\n\n      this.$axios.get(this.$api.planManage + '/' + id).then(function (response) {\n        _this2.DeployForm.title = response.data['res']['title'];\n        _this2.DeployForm.category_id = response.data['res']['category_id'];\n        _this2.DeployForm.version = response.data['res']['version'];\n        _this2.DeployForm.post_author = response.data['res']['author'];\n      });\n    },\n    judgeCreateOrEdit: function judgeCreateOrEdit() {\n      if (this.$route.path.indexOf('edit') >= 0) {\n        this.deployEditFlag = true;\n        this.subHeader = '编辑部署';\n        this.deployEditId = this.$route.path.split('/')[3];\n        this.initDeployFormEdit(this.deployEditId);\n      } else {\n        this.planEditFlag = false;\n        this.subHeader = '转部署';\n        this.planForDeployId = this.$route.path.split('/')[3];\n        this.initDeployFormGoto(this.planForDeployId);\n      }\n    },\n    goBack: function goBack() {\n      this.$router.go(-1);\n    },\n    editorOnReady: function editorOnReady(editor) {\n      editor.ui.getEditableElement().parentElement.insertBefore(editor.ui.view.toolbar.element, editor.ui.getEditableElement());\n\n      editor.plugins.get('FileRepository').createUploadAdapter = function (loader) {\n        var val = editor.getData();\n        return {\n          upload: function () {\n            var _upload = _asyncToGenerator(\n            /*#__PURE__*/\n            regeneratorRuntime.mark(function _callee() {\n              return regeneratorRuntime.wrap(function _callee$(_context) {\n                while (1) {\n                  switch (_context.prev = _context.next) {\n                    case 0:\n                      _context.next = 2;\n                      return loader.file.then(function (f) {\n                        var F = new FileReader();\n                        F.readAsArrayBuffer(f);\n                        return new Promise(function (resolve) {\n                          F.onload = function () {\n                            resolve(F.result);\n                          };\n                        });\n                      }).then(function (bufAsArray) {\n                        return {\n                          default: ''\n                        };\n                      });\n\n                    case 2:\n                      return _context.abrupt(\"return\", _context.sent);\n\n                    case 3:\n                    case \"end\":\n                      return _context.stop();\n                  }\n                }\n              }, _callee);\n            }));\n\n            function upload() {\n              return _upload.apply(this, arguments);\n            }\n\n            return upload;\n          }()\n        };\n      };\n    },\n    submitForm: function submitForm(formName) {\n      var _this3 = this;\n\n      this.$refs[formName].validate(function (valid) {\n        if (valid) {\n          var data = {\n            \"title\": _this3.DeployForm.title,\n            \"category_id\": _this3.DeployForm.category_id,\n            \"version\": _this3.DeployForm.version,\n            \"post_author\": _this3.DeployForm.post_author,\n            \"environment_id\": _this3.DeployForm.environment_id,\n            \"deploy_links\": _this3.DeployForm.deploy_links,\n            \"deploy_sql\": _this3.DeployForm.deploy_sql,\n            \"deploy_describe\": _this3.DeployForm.deploy_describe,\n            \"body\": _this3.DeployForm.body,\n            \"report_file_names\": _this3.DeployForm.fileNames\n          };\n\n          if (_this3.deployEditFlag === false) {\n            _this3.$axios.post(_this3.$api.planGotoDeploy.replace(/PLAN_ID/g, _this3.planForDeployId), data).then(function (response) {\n              if (_this3.messageShow(_this3, response)) {\n                _this3.$router.push('/management/deploys');\n\n                _this3.deployList();\n              }\n            }).catch(function (error) {\n              _this3.errorMessageShow(_this3, error.response);\n            });\n          } else {\n            _this3.$axios.put(_this3.$api.deployManage + '/' + _this3.deployEditId, data).then(function (response) {\n              if (_this3.messageShow(_this3, response)) {\n                _this3.$router.push('/management/deploys');\n\n                _this3.deployList();\n              }\n            }).catch(function (error) {\n              _this3.errorMessageShow(_this3, error.response);\n            });\n          }\n        } else {\n          console.log('error submit!!');\n          return false;\n        }\n      });\n    },\n    resetForm: function resetForm(formName) {\n      this.$refs[formName].resetFields();\n    },\n    addFile: function addFile(response, file, fileList) {\n      if (response['code'] === 200) {\n        this.$notify({\n          title: '成功',\n          message: response['msg'],\n          type: 'success'\n        });\n\n        if (this.DeployForm.fileNames === null) {\n          this.DeployForm.fileNames = file.name + ',';\n        } else {\n          this.DeployForm.fileNames += file.name + ',';\n        }\n\n        console.log(this.DeployForm.fileNames);\n      } else {\n        fileList.pop();\n        this.fileList = fileList;\n        this.$notify({\n          title: '警告',\n          message: response['msg'],\n          type: 'warning'\n        });\n      }\n    },\n    removeFile: function removeFile(file, fileList) {\n      var _this4 = this;\n\n      var repStr = file.name + ',';\n      this.DeployForm.fileNames = this.DeployForm.fileNames.replace(repStr, '');\n      console.log(this.DeployForm.fileNames);\n      this.$axios.get(this.$api.removeReport + file.name).then(function (response) {\n        _this4.messageShow(_this4, response);\n      });\n    }\n  }\n};",{"version":3,"sources":["DeployEdit.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\r\n<div>\r\n    <el-page-header @back=\"goBack\" v-bind:content=\"subHeader\"></el-page-header>\r\n    <el-divider></el-divider>\r\n    <el-form :model=\"DeployForm\" :rules=\"rules\" ref=\"DeployForm\" label-width=\"150px\" class=\"demo-DeployForm\" label-position=\"top\">\r\n        <el-form-item label=\"标题\" prop=\"title\" size=\"small\" >\r\n            <el-input v-model=\"DeployForm.title\" class=\"commonwidth\" :disabled=\"true\"></el-input>\r\n        </el-form-item>\r\n        <el-form-item label=\"发布版本\" prop=\"version\" size=\"small\">\r\n            <el-input v-model=\"DeployForm.version\" class=\"commonwidth\" :disabled=\"true\"></el-input>\r\n        </el-form-item>\r\n        <el-row :gutter=\"10\">\r\n          <el-col :span=\"4\">\r\n            <el-form-item label=\"项目\" prop=\"category_id\" size=\"small\">\r\n                <el-select v-model=\"DeployForm.category_id\" placeholder=\"请选择项目\" :disabled=true>\r\n                  <el-option\r\n                    v-for=\"item in categorys\"\r\n                    :key=\"item.id\"\r\n                    :label=\"item.name\"\r\n                    :value=\"item.id\">\r\n                  </el-option>\r\n                </el-select>\r\n            </el-form-item>\r\n          </el-col>\r\n          <el-col :span=\"4\">\r\n            <el-form-item label=\"责任人\" prop=\"post_author\" class=\"authorwidth\" size=\"small\">\r\n                <el-input v-model=\"DeployForm.post_author\" :disabled=\"true\"></el-input>\r\n            </el-form-item>\r\n          </el-col>\r\n        </el-row>\r\n        <el-form-item label=\"转测范围\" prop=\"deploy_describe\" class=\"deploytext\" size=\"small\">\r\n            <el-input type=\"textarea\" v-model=\"DeployForm.deploy_describe\"></el-input>\r\n        </el-form-item>\r\n        <el-form-item label=\"部署环境\" prop=\"environment_id\" size=\"small\">\r\n            <el-select v-model=\"DeployForm.environment_id\" placeholder=\"请选择部署环境\">\r\n                <el-option\r\n                v-for=\"item in environments\"\r\n                :key=\"item.value\"\r\n                :label=\"item.label\"\r\n                :value=\"item.value\">\r\n                </el-option>\r\n            </el-select>\r\n        </el-form-item>\r\n        <el-form-item label=\"部署包下载链接\" prop=\"deploy_links\" class=\"deploytext\" size=\"small\">\r\n            <el-input type=\"textarea\" v-model=\"DeployForm.deploy_links\" placeholder=\"http://***.tar.gz;http://***.tar.gz\"></el-input>\r\n        </el-form-item>\r\n        <el-form-item label=\"SQL文件\" prop=\"deploy_sql\" class=\"deploytext\" size=\"small\">\r\n            <el-input type=\"textarea\" v-model=\"DeployForm.deploy_sql\"></el-input>\r\n        </el-form-item>\r\n        <el-form-item label=\"测试报告\" prop=\"body\" size=\"small\">\r\n          <div  class=\"deploytext\">\r\n          <ckeditor :editor=\"editor\" @ready=\"editorOnReady\" v-model=\"DeployForm.body\" :config=\"editorConfig\">\r\n          </ckeditor>\r\n          <el-divider></el-divider>\r\n          </div>\r\n        </el-form-item>\r\n        <el-form-item>\r\n          <el-upload\r\n            class=\"upload-demo\"\r\n            :action=\"this.$api.uploadReport\"\r\n            :on-success=\"addFile\"\r\n            :on-remove=\"removeFile\"\r\n            :file-list=\"fileList\">\r\n            <el-button size=\"small\" type=\"primary\">点击上传</el-button>\r\n            <div slot=\"tip\" class=\"el-upload__tip\">支持多个文件，单个文件大小不超过10MB</div>\r\n          </el-upload>\r\n        </el-form-item>\r\n        <el-form-item>\r\n            <el-button type=\"primary\" @click=\"submitForm('DeployForm')\">确定</el-button>\r\n            <el-button @click=\"resetForm('DeployForm')\">重置</el-button>\r\n        </el-form-item>\r\n    </el-form>\r\n</div>\r\n</template>\r\n\r\n<script>\r\nimport '@ckeditor/ckeditor5-build-decoupled-document/build/translations/zh-cn'\r\nimport DecoupledEditor from '@ckeditor/ckeditor5-build-decoupled-document'\r\n// import func from '../../../vue-temp/vue-editor-bridge';\r\n\r\n  export default {\r\n    props: ['categorys'],\r\n    data() {\r\n      return {\r\n        editor: DecoupledEditor,\r\n        editorConfig: {\r\n            language: 'zh-cn',\r\n            fontSize: {\r\n                options: [8, 10, 'default', 14, 16, 18, 20, 22, 24, 26, 28, 32, 48]\r\n            },\r\n            fontFamily:{\r\n                options: ['宋体', '仿宋', '微软雅黑', '黑体', '仿宋_GB2312', '楷体', '隶书', '幼圆']\r\n            }\r\n        },\r\n        deployEditFlag: false,\r\n        deployEditId: '',\r\n        planForDeployId: '',\r\n        subHeader: '',\r\n        fileList: [],\r\n        DeployForm: {\r\n          title: '',\r\n          category_id: '',\r\n          version: '',\r\n          post_author: '',\r\n          deploy_links: '',\r\n          deploy_sql: '',\r\n          deploy_describe: '',\r\n          body: '',\r\n          environment_id: null,\r\n          fileNames: null\r\n        },\r\n        rules: {\r\n          title: [\r\n            { required: true, message: '请输入部署标题', trigger: 'blur' },\r\n            { min: 3, max: 60, message: '长度在 3 到 60 个字符', trigger: 'blur' }\r\n          ],\r\n          category_id: [\r\n            { required: true, message: '请选择所属项目', trigger: 'change' }\r\n          ],\r\n          version: [\r\n            { required: true, message: '请输入发布版本', trigger: 'blur' },\r\n            { min: 3, max: 60, message: '长度在 3 到 60 个字符', trigger: 'blur' }\r\n          ],\r\n          deploy_describe: [\r\n            { required: true, message: '请填写转测范围', trigger: 'blur' }\r\n          ],\r\n          deploy_links: [\r\n            { required: true, message: '请填写部署包下载链接', trigger: 'blur' }\r\n          ],\r\n          environment_id: [\r\n            { required: true, message: '请选择部署环境', trigger: 'change' }\r\n          ],\r\n          body: [\r\n            { required: true, message: '请将测试报告复制到此处', trigger: 'blur' },\r\n          ]\r\n        },\r\n        environments: [{\r\n            value: 2,\r\n            label: 'yfb-uco'\r\n            }, {\r\n            value: 3,\r\n            label: 'UCA-LF'\r\n            }, {\r\n            value: 5,\r\n            label: 'UCA-TJ'\r\n            }, {\r\n            value: 6,\r\n            label: 'UCA-BJ'\r\n            }, {\r\n            value: 7,\r\n            label: 'CVM-TJ'\r\n            }, {\r\n            value: 8,\r\n            label: 'CVM-BJ'\r\n            }, {\r\n            value: 10,\r\n            label: 'CVM-LF'\r\n            }, {\r\n            value: 11,\r\n            label: 'CVK-TJ'\r\n            }, {\r\n            value: 13,\r\n            label: 'CVK-BJ'\r\n            }, {\r\n            value: 15,\r\n            label: 'CVK-LF'\r\n            }, {\r\n            value: 17,\r\n            label: 'VCFC-TJ'\r\n            }, {\r\n            value: 18,\r\n            label: 'VCFC-BJ'\r\n            }, {\r\n            value: 19,\r\n            label: 'VCFC-LF'\r\n        }],\r\n      };\r\n    },\r\n    mounted() {\r\n      this.judgeCreateOrEdit();\r\n    },\r\n    methods: {\r\n      initDeployFormEdit(id){\r\n          this.$axios.get((this.$api.deployManage + '/' + id)).then((response) => {\r\n            this.DeployForm.title = response.data['res']['title']\r\n            this.DeployForm.category_id = response.data['res']['category_id']\r\n            this.DeployForm.version = response.data['res']['version']\r\n            this.DeployForm.post_author = response.data['res']['post_author']\r\n            this.DeployForm.environment_id = response.data['res']['environment_id']\r\n            this.DeployForm.deploy_links = response.data['res']['deploy_links']\r\n            this.DeployForm.deploy_sql = response.data['res']['deploy_sql']\r\n            this.DeployForm.deploy_describe = response.data['res']['deploy_describe']\r\n            this.DeployForm.body = response.data['res']['body']\r\n            this.DeployForm.fileNames = response.data['res']['report_file_names']\r\n            this.fileList = response.data['fileList']\r\n          })\r\n      },\r\n      initDeployFormGoto(id){\r\n          this.$axios.get((this.$api.planManage + '/' + id)).then((response) => {\r\n            this.DeployForm.title = response.data['res']['title']\r\n            this.DeployForm.category_id = response.data['res']['category_id']\r\n            this.DeployForm.version = response.data['res']['version']\r\n            this.DeployForm.post_author = response.data['res']['author']\r\n          })\r\n      },\r\n      judgeCreateOrEdit(){\r\n          if(this.$route.path.indexOf('edit') >= 0){\r\n              this.deployEditFlag = true\r\n              this.subHeader = '编辑部署'\r\n              this.deployEditId = this.$route.path.split('/')[3]\r\n              this.initDeployFormEdit(this.deployEditId)\r\n          }else{\r\n              this.planEditFlag = false\r\n              this.subHeader = '转部署'\r\n              this.planForDeployId = this.$route.path.split('/')[3]\r\n              this.initDeployFormGoto(this.planForDeployId)\r\n          }\r\n      },\r\n      goBack(){\r\n          this.$router.go(-1);\r\n      },\r\n      editorOnReady(editor){\r\n          editor.ui.getEditableElement().parentElement.insertBefore(\r\n              editor.ui.view.toolbar.element,\r\n              editor.ui.getEditableElement()\r\n          );\r\n          editor.plugins.get('FileRepository').createUploadAdapter = function(loader){\r\n              let val = editor.getData();\r\n              return{\r\n                  upload: async function(){\r\n                      return await loader.file.then(f => {\r\n                          const F = new FileReader();\r\n                          F.readAsArrayBuffer(f);\r\n                          return new Promise(resolve => {\r\n                              F.onload = function(){\r\n                                  resolve(F.result)\r\n                              };\r\n                          })\r\n                      }).then(bufAsArray => {\r\n                          return{\r\n                              default: ''\r\n                          }\r\n                      });\r\n                  }\r\n              }\r\n          };\r\n      },\r\n      submitForm(formName) {\r\n        this.$refs[formName].validate((valid) => {\r\n          if (valid) {\r\n            let data = {\r\n              \"title\": this.DeployForm.title,\r\n              \"category_id\": this.DeployForm.category_id,\r\n              \"version\": this.DeployForm.version,\r\n              \"post_author\": this.DeployForm.post_author,\r\n              \"environment_id\": this.DeployForm.environment_id,\r\n              \"deploy_links\": this.DeployForm.deploy_links,\r\n              \"deploy_sql\": this.DeployForm.deploy_sql,\r\n              \"deploy_describe\": this.DeployForm.deploy_describe,\r\n              \"body\": this.DeployForm.body,\r\n              \"report_file_names\": this.DeployForm.fileNames\r\n            }\r\n            if (this.deployEditFlag === false){\r\n              this.$axios.post((this.$api.planGotoDeploy.replace(/PLAN_ID/g, this.planForDeployId)), data).then((response) => {\r\n                if (this.messageShow(this, response)){\r\n                  this.$router.push('/management/deploys')\r\n                  this.deployList();\r\n                }\r\n              }).catch((error) => {\r\n                this.errorMessageShow(this, error.response);\r\n              })\r\n            }else{\r\n              this.$axios.put((this.$api.deployManage + '/' + this.deployEditId), data).then((response) => {\r\n                if (this.messageShow(this, response)){\r\n                  this.$router.push('/management/deploys')\r\n                  this.deployList();\r\n                }\r\n              }).catch((error) => {\r\n                this.errorMessageShow(this, error.response);\r\n              })\r\n            }\r\n          } else {\r\n            console.log('error submit!!');\r\n            return false;\r\n          }\r\n        });\r\n      },\r\n      resetForm(formName) {\r\n        this.$refs[formName].resetFields();\r\n      },\r\n      addFile(response, file, fileList) {\r\n        if(response['code'] === 200){\r\n          this.$notify({\r\n              title: '成功',\r\n              message: response['msg'],\r\n              type: 'success',\r\n          });\r\n          if (this.DeployForm.fileNames === null){\r\n              this.DeployForm.fileNames = file.name + ','\r\n          }else{\r\n              this.DeployForm.fileNames += (file.name + ',')\r\n          }\r\n          console.log(this.DeployForm.fileNames)\r\n        }else{\r\n          fileList.pop()\r\n          this.fileList = fileList\r\n          this.$notify({\r\n              title: '警告',\r\n              message: response['msg'],\r\n              type: 'warning',\r\n          });\r\n        }\r\n      },\r\n      removeFile(file, fileList){\r\n        let repStr = file.name + ','\r\n        this.DeployForm.fileNames = this.DeployForm.fileNames.replace(repStr, '')\r\n        console.log(this.DeployForm.fileNames)\r\n        this.$axios.get((this.$api.removeReport + file.name)).then((response) =>{\r\n          this.messageShow(this, response)\r\n        })\r\n      }\r\n    }\r\n  }\r\n</script>"],"sourceRoot":"src/components/deploy"}]}