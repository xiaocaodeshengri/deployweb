{"remainingRequest":"D:\\workFiles\\deployweb\\node_modules\\babel-loader\\lib\\index.js!D:\\workFiles\\deployweb\\node_modules\\cache-loader\\dist\\cjs.js??ref--0-0!D:\\workFiles\\deployweb\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\workFiles\\deployweb\\src\\components\\deploy\\DeployDetail.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\workFiles\\deployweb\\src\\components\\deploy\\DeployDetail.vue","mtime":1583747397518},{"path":"D:\\workFiles\\deployweb\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\workFiles\\deployweb\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"D:\\workFiles\\deployweb\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\workFiles\\deployweb\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["import \"core-js/modules/es6.regexp.replace\";\nimport \"regenerator-runtime/runtime\";\nimport _asyncToGenerator from \"D:\\\\workFiles\\\\deployweb\\\\node_modules\\\\@babel\\\\runtime-corejs2/helpers/esm/asyncToGenerator\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport '@ckeditor/ckeditor5-build-decoupled-document/build/translations/zh-cn';\nimport DecoupledEditor from '@ckeditor/ckeditor5-build-decoupled-document';\nexport default {\n  inject: ['reload'],\n  data: function data() {\n    return {\n      editor: DecoupledEditor,\n      editorConfig: {\n        language: 'zh-cn',\n        fontSize: {\n          options: [8, 10, 'default', 14, 16, 18, 20, 22, 24, 26, 28, 32, 48]\n        },\n        fontFamily: {\n          options: ['宋体', '仿宋', '微软雅黑', '黑体', '仿宋_GB2312', '楷体', '隶书', '幼圆']\n        }\n      },\n      dialog: false,\n      loading: false,\n      activeNames: ['1'],\n      deploy: {\n        title: \"\",\n        body: \"\",\n        timestamp: \"\",\n        category: \"\",\n        post_author: \"\",\n        deploy_uco: \"\",\n        deploy_uca: \"\",\n        deploy_ucs: \"\",\n        deploy_links: \"\",\n        environment: \"\",\n        deploy_sql: \"\",\n        deploy_describe: \"\",\n        version: \"\",\n        api_task_id: \"\",\n        api_test_report: \"\"\n      },\n      fileList: [],\n      tableData: [],\n      commentForm: {\n        author: '',\n        site: '',\n        body: '',\n        bug_id: '',\n        environment_id: null\n      },\n      rules: {\n        author: [{\n          required: true,\n          message: '请输入责任人',\n          trigger: 'blur'\n        }],\n        site: [{\n          required: true,\n          message: '请输入下载链接',\n          trigger: 'blur'\n        }],\n        body: [{\n          required: true,\n          message: '请输入再次部署原因',\n          trigger: 'blur'\n        }],\n        bug_id: [{\n          required: false,\n          message: '请填写对应禅道BUG ID',\n          trigger: 'blur'\n        }],\n        environment_id: [{\n          required: true,\n          message: '请选择部署环境',\n          trigger: 'change'\n        }]\n      },\n      environments: [{\n        value: 2,\n        label: 'yfb-uco'\n      }, {\n        value: 3,\n        label: 'UCA-LF'\n      }, {\n        value: 5,\n        label: 'UCA-TJ'\n      }, {\n        value: 6,\n        label: 'UCA-BJ'\n      }, {\n        value: 7,\n        label: 'CVM-TJ'\n      }, {\n        value: 8,\n        label: 'CVM-BJ'\n      }, {\n        value: 10,\n        label: 'CVM-LF'\n      }, {\n        value: 11,\n        label: 'CVK-TJ'\n      }, {\n        value: 13,\n        label: 'CVK-BJ'\n      }, {\n        value: 15,\n        label: 'CVK-LF'\n      }, {\n        value: 17,\n        label: 'VCFC-TJ'\n      }, {\n        value: 18,\n        label: 'VCFC-BJ'\n      }, {\n        value: 19,\n        label: 'VCFC-LF'\n      }]\n    };\n  },\n  mounted: function mounted() {\n    this.initDeployDetial();\n    this.getComments();\n  },\n  methods: {\n    editorOnReady: function editorOnReady(editor) {\n      editor.ui.getEditableElement().parentElement.insertBefore(editor.ui.view.toolbar.element, editor.ui.getEditableElement());\n\n      editor.plugins.get('FileRepository').createUploadAdapter = function (loader) {\n        var val = editor.getData();\n        return {\n          upload: function () {\n            var _upload = _asyncToGenerator(\n            /*#__PURE__*/\n            regeneratorRuntime.mark(function _callee() {\n              return regeneratorRuntime.wrap(function _callee$(_context) {\n                while (1) {\n                  switch (_context.prev = _context.next) {\n                    case 0:\n                      _context.next = 2;\n                      return loader.file.then(function (f) {\n                        var F = new FileReader();\n                        F.readAsArrayBuffer(f);\n                        return new Promise(function (resolve) {\n                          F.onload = function () {\n                            resolve(F.result);\n                          };\n                        });\n                      }).then(function (bufAsArray) {\n                        return {\n                          default: ''\n                        };\n                      });\n\n                    case 2:\n                      return _context.abrupt(\"return\", _context.sent);\n\n                    case 3:\n                    case \"end\":\n                      return _context.stop();\n                  }\n                }\n              }, _callee);\n            }));\n\n            function upload() {\n              return _upload.apply(this, arguments);\n            }\n\n            return upload;\n          }()\n        };\n      };\n    },\n    resetForm: function resetForm(formName) {\n      this.$refs[formName].resetFields();\n    },\n    initDeployDetial: function initDeployDetial() {\n      var _this = this;\n\n      var id = this.$route.params.id;\n      this.$axios.get(this.$api.deployManage + '/' + id).then(function (response) {\n        _this.deploy.title = response.data['res']['title'];\n        _this.deploy.category = response.data['res']['category'];\n        _this.deploy.version = response.data['res']['version'];\n        _this.deploy.post_author = response.data['res']['post_author'];\n        _this.deploy.deploy_uco = response.data['res']['deploy_uco'];\n        _this.deploy.deploy_uca = response.data['res']['deploy_uca'];\n        _this.deploy.deploy_ucs = response.data['res']['deploy_ucs'];\n        _this.deploy.deploy_sql = response.data['res']['deploy_sql'];\n        _this.deploy.deploy_links = response.data['res']['deploy_links'];\n        _this.deploy.environment = response.data['res']['environment_name'];\n        _this.deploy.deploy_describe = response.data['res']['deploy_describe'];\n        _this.deploy.body = response.data['res']['body'];\n        _this.deploy.api_task_id = response.data['res']['api_task_id'];\n        _this.deploy.api_test_report = response.data['res']['api_test_report'];\n        _this.deploy.timestamp = response.data['res']['timestamp'];\n        _this.fileList = response.data['fileList'];\n      });\n    },\n    goBack: function goBack() {\n      this.$router.go(-1);\n    },\n    beginDeploy: function beginDeploy() {\n      var _this2 = this;\n\n      var post_id = this.$route.params.id;\n      this.$axios.get(this.$api.postDeploy + post_id).then(function (response) {\n        _this2.$notify({\n          title: '开始部署',\n          message: '正在进行部署，部署完成后会有邮件通知',\n          type: 'success'\n        });\n\n        _this2.messageShow(_this2, response);\n      }).catch(function (error) {\n        _this2.errorMessageShow(_this2, error.response);\n      });\n    },\n    getComments: function getComments() {\n      var _this3 = this;\n\n      var deploy_id = this.$route.params.id;\n      this.$axios.get(this.$api.commentList.replace(/DEPLOY_ID/g, deploy_id), {\n        params: {\n          page: 1,\n          size: 100\n        }\n      }).then(function (response) {\n        _this3.tableData = response.data['res'];\n      });\n    },\n    addComment: function addComment() {\n      this.dialog = true;\n      this.commentForm.author = localStorage.getItem(\"name\");\n    },\n    commentDeploy: function commentDeploy(id) {\n      var _this4 = this;\n\n      this.$axios.get(this.$api.commentDeploy + id).then(function (response) {\n        _this4.$notify({\n          title: '开始部署',\n          message: '正在进行部署，部署完成后会有邮件通知',\n          type: 'success'\n        });\n\n        _this4.messageShow(_this4, response);\n      }).catch(function (error) {\n        _this4.errorMessageShow(_this4, error.response);\n      });\n    },\n    deleteComment: function deleteComment(id) {\n      var _this5 = this;\n\n      this.$axios.delete(this.$api.commentDelete + id).then(function (response) {\n        if (_this5.messageShow(_this5, response)) {\n          _this5.reload();\n        }\n      }).catch(function (error) {\n        _this5.errorMessageShow(_this5, error.response);\n      });\n    },\n    addCommentBtn: function addCommentBtn() {\n      var _this6 = this;\n\n      this.$confirm('确定要提交再次部署申请吗？').then(function () {\n        _this6.loading = true;\n        var deploy_id = _this6.$route.params.id;\n        var data = {\n          \"author\": _this6.commentForm.author,\n          \"site\": _this6.commentForm.site,\n          \"body\": _this6.commentForm.body,\n          \"bug_id\": _this6.commentForm.bug_id,\n          \"environment_id\": _this6.commentForm.environment_id\n        };\n\n        _this6.$axios.post(_this6.$api.commentAdd.replace(/DEPLOY_ID/g, deploy_id), data).then(function (response) {\n          if (_this6.messageShow(_this6, response)) {\n            _this6.loading = false;\n            _this6.dialog = false;\n\n            _this6.reload();\n          }\n        }).catch(function (error) {\n          _this6.loading = false;\n          _this6.dialog = false;\n\n          _this6.errorMessageShow(_this6, error.response);\n        });\n      });\n    },\n    downloadUrl: function downloadUrl(fileName) {\n      var url = this.$api.fileDownload + 'report/' + fileName;\n      return url;\n    }\n  }\n};",{"version":3,"sources":["DeployDetail.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\r\n    <div>\r\n        <el-page-header @back=\"goBack\" :content=\"deploy.title\"></el-page-header>\r\n        <el-divider></el-divider>\r\n        <el-collapse v-model=\"activeNames\">\r\n            <el-collapse-item title=\"基本信息\" name=\"1\">\r\n                <ul>\r\n                    <li>项目:</li>{{ deploy.category }}\r\n                    <li>日期:</li> {{ deploy.timestamp }}\r\n                    <li>责任人:</li> {{ deploy.post_author }}\r\n                    <li>发布版本:</li>{{ deploy.version }}\r\n                    <li>转测范围:</li>{{ deploy.deploy_describe }}\r\n                </ul>\r\n            </el-collapse-item>\r\n            <el-collapse-item title=\"下载链接\" name=\"2\">\r\n                <ul>\r\n                    <li>部署环境:</li>{{ deploy.environment }}\r\n                    <li>部署包下载链接:</li>{{ deploy.deploy_links }}\r\n                    <li v-if=\"deploy.deploy_uco != null\">UCO部署包下载链接:</li>{{ deploy.deploy_uco }}\r\n                    <li v-if=\"deploy.deploy_uca != null\">UCA部署包下载链接:</li>{{ deploy.deploy_uca }}\r\n                    <li v-if=\"deploy.deploy_ucs != null\">UCS部署包获取路径:</li>{{ deploy.deploy_ucs }}\r\n                    <li v-if=\"deploy.deploy_sql != ''\">SQL脚本:</li>{{ deploy.deploy_sql }}\r\n                </ul>\r\n            </el-collapse-item>\r\n            <el-collapse-item title=\"测试报告\" name=\"3\">\r\n                <ul>\r\n                    <span v-html=\"deploy.body\"></span>\r\n                </ul>\r\n            </el-collapse-item>\r\n            <el-collapse-item title=\"测试报告文档\" name=\"4\">\r\n                <li v-for=\"(item, index) in fileList\" :key=\"index\">\r\n                    <a :href=\"downloadUrl(item.name)\">{{ item.name }}</a>\r\n                </li>\r\n            </el-collapse-item>\r\n        </el-collapse>\r\n\r\n        <el-divider content-position=\"right\">\r\n        <el-button type=\"warning\" size=\"mini\" round plain\r\n                    @click.native=\"beginDeploy()\">开始部署\r\n        </el-button>\r\n        <el-button type=\"primary\" size=\"mini\" round plain\r\n                    @click.native=\"addComment()\">再次部署\r\n        </el-button>\r\n        </el-divider>\r\n\r\n        <el-divider content-position=\"left\">再次部署记录</el-divider>\r\n\r\n        <el-table\r\n            :data=\"tableData\"\r\n            style=\"width: 100%\">\r\n            <el-table-column type=\"expand\">\r\n            <template slot-scope=\"props\">\r\n                <el-form label-position=\"left\" inline class=\"demo-table-expand\">\r\n                    <el-form-item label=\"部署环境\">\r\n                        <span>{{ props.row.environment_name }}</span>\r\n                    </el-form-item>\r\n                    <el-form-item label=\"下载链接\">\r\n                        <span>{{ props.row.site }}</span>\r\n                    </el-form-item>\r\n                    <el-form-item label=\"描述\">\r\n                        <ul>\r\n                            <span v-html=\"props.row.body\"></span>\r\n                        </ul>\r\n                    </el-form-item>\r\n                </el-form>\r\n            </template>\r\n            </el-table-column>\r\n            <el-table-column\r\n            label=\"责任人\"\r\n            prop=\"author\">\r\n            </el-table-column>\r\n            <el-table-column\r\n            label=\"禅道BUG ID\"\r\n            prop=\"bug_id\">\r\n            </el-table-column>\r\n            <el-table-column\r\n            label=\"时间\"\r\n            prop=\"timestamp\">\r\n            </el-table-column>\r\n            <el-table-column\r\n            label=\"操作\">\r\n                <template slot-scope=\"scope\">\r\n                    <el-button type=\"primary\" size=\"mini\" round plain\r\n                                @click.native=\"commentDeploy(tableData[scope.$index]['id'])\"\r\n                                >Deploy\r\n                    </el-button>\r\n                    <el-button type=\"danger\" icon=\"el-icon-delete\" size=\"mini\" circle plain\r\n                                @click.native=\"sureView(deleteComment,tableData[scope.$index]['id'],'')\">\r\n                    </el-button>\r\n                </template>\r\n            </el-table-column>\r\n        </el-table>\r\n        <!-- <el-backtop target=\".page-component__scroll .el-scrollbar__wrap\"></el-backtop> -->\r\n\r\n        <el-drawer\r\n        title=\"再次部署申请\"\r\n        :visible.sync=\"dialog\"\r\n        direction=\"rtl\"\r\n        custom-class=\"demo-drawer\"\r\n        ref=\"drawer\"\r\n        size=\"50%\">\r\n            <div class=\"demo-drawer__content\">\r\n                <el-form :model=\"commentForm\" :rules=\"rules\" ref=\"commentForm\" label-width=\"100px\">\r\n                    <el-form-item label=\"责任人\" prop=\"author\" size=\"small\">\r\n                        <el-input v-model=\"commentForm.author\" autocomplete=\"off\" :disabled=\"true\"></el-input>\r\n                    </el-form-item>\r\n                    <el-form-item label=\"禅道BUG ID\" prop=\"bug_id\" size=\"small\">\r\n                        <el-input v-model=\"commentForm.bug_id\" autocomplete=\"off\"></el-input>\r\n                    </el-form-item>\r\n                    <el-form-item label=\"部署环境\" prop=\"environment_id\" size=\"small\">\r\n                        <el-select v-model=\"commentForm.environment_id\" placeholder=\"请选择部署环境\">\r\n                            <el-option\r\n                            v-for=\"item in environments\"\r\n                            :key=\"item.value\"\r\n                            :label=\"item.label\"\r\n                            :value=\"item.value\">\r\n                            </el-option>\r\n                        </el-select>\r\n                    </el-form-item>\r\n                    <el-form-item label=\"部署包路径\" prop=\"site\" size=\"small\">\r\n                        <el-input type=\"textarea\" v-model=\"commentForm.site\" autocomplete=\"off\"\r\n                        placeholder=\"http://***.tar.gz;http://***.tar.gz\"></el-input>\r\n                    </el-form-item>\r\n                    <el-form-item label=\"事务记录\" prop=\"body\" size=\"small\">\r\n                        <div>\r\n                        <ckeditor :editor=\"editor\" @ready=\"editorOnReady\" v-model=\"commentForm.body\" :config=\"editorConfig\">\r\n                        </ckeditor>\r\n                        <el-divider></el-divider>\r\n                        </div>\r\n                    </el-form-item>\r\n                </el-form>\r\n                <div class=\"demo-drawer__footer\">\r\n                <el-button type=\"primary\" @click.native=\"addCommentBtn()\" :loading=\"loading\">{{ loading ? '提交中 ...' : '确 定' }}</el-button>\r\n                <el-button @click=\"dialog = false\">取 消</el-button>\r\n                <el-button @click=\"resetForm('commentForm')\">重置</el-button>\r\n                </div>\r\n            </div>\r\n        </el-drawer>\r\n\r\n    </div>\r\n</template>\r\n\r\n<script>\r\nimport '@ckeditor/ckeditor5-build-decoupled-document/build/translations/zh-cn'\r\nimport DecoupledEditor from '@ckeditor/ckeditor5-build-decoupled-document'\r\n\r\nexport default {\r\n    inject: ['reload'],\r\n    data(){\r\n        return{\r\n            editor: DecoupledEditor,\r\n            editorConfig: {\r\n                language: 'zh-cn',\r\n                fontSize: {\r\n                    options: [8, 10, 'default', 14, 16, 18, 20, 22, 24, 26, 28, 32, 48]\r\n                },\r\n                fontFamily:{\r\n                    options: ['宋体', '仿宋', '微软雅黑', '黑体', '仿宋_GB2312', '楷体', '隶书', '幼圆']\r\n                }\r\n            },\r\n            dialog: false,\r\n            loading: false,\r\n            activeNames: ['1'],\r\n            deploy: {\r\n                title: \"\",\r\n                body: \"\",\r\n                timestamp: \"\",\r\n                category: \"\",\r\n                post_author: \"\",\r\n                deploy_uco: \"\",\r\n                deploy_uca: \"\",\r\n                deploy_ucs: \"\",\r\n                deploy_links: \"\",\r\n                environment: \"\",\r\n                deploy_sql: \"\",\r\n                deploy_describe: \"\",\r\n                version: \"\",\r\n                api_task_id: \"\",\r\n                api_test_report: \"\"\r\n            },\r\n            fileList: [],\r\n            tableData: [],\r\n            commentForm: {\r\n                author: '',\r\n                site: '',\r\n                body: '',\r\n                bug_id: '',\r\n                environment_id: null\r\n            },\r\n            rules: {\r\n                author: [\r\n                    { required: true, message: '请输入责任人', trigger: 'blur' },\r\n                ],\r\n                site: [\r\n                    { required: true, message: '请输入下载链接', trigger: 'blur' }\r\n                ],\r\n                body: [\r\n                    { required: true, message: '请输入再次部署原因', trigger: 'blur' },\r\n                ],\r\n                bug_id: [\r\n                    { required: false, message: '请填写对应禅道BUG ID', trigger: 'blur' }\r\n                ],\r\n                environment_id: [\r\n                    { required: true, message: '请选择部署环境', trigger: 'change' }\r\n                ]\r\n            },\r\n            environments: [{\r\n                value: 2,\r\n                label: 'yfb-uco'\r\n                }, {\r\n                value: 3,\r\n                label: 'UCA-LF'\r\n                }, {\r\n                value: 5,\r\n                label: 'UCA-TJ'\r\n                }, {\r\n                value: 6,\r\n                label: 'UCA-BJ'\r\n                }, {\r\n                value: 7,\r\n                label: 'CVM-TJ'\r\n                }, {\r\n                value: 8,\r\n                label: 'CVM-BJ'\r\n                }, {\r\n                value: 10,\r\n                label: 'CVM-LF'\r\n                }, {\r\n                value: 11,\r\n                label: 'CVK-TJ'\r\n                }, {\r\n                value: 13,\r\n                label: 'CVK-BJ'\r\n                }, {\r\n                value: 15,\r\n                label: 'CVK-LF'\r\n                }, {\r\n                value: 17,\r\n                label: 'VCFC-TJ'\r\n                }, {\r\n                value: 18,\r\n                label: 'VCFC-BJ'\r\n                }, {\r\n                value: 19,\r\n                label: 'VCFC-LF'\r\n            }],\r\n        }\r\n    },\r\n    mounted() {\r\n        this.initDeployDetial();\r\n        this.getComments();\r\n    },\r\n    methods: {\r\n        editorOnReady(editor){\r\n            editor.ui.getEditableElement().parentElement.insertBefore(\r\n                editor.ui.view.toolbar.element,\r\n                editor.ui.getEditableElement()\r\n            );\r\n            editor.plugins.get('FileRepository').createUploadAdapter = function(loader){\r\n                let val = editor.getData();\r\n                return{\r\n                    upload: async function(){\r\n                        return await loader.file.then(f => {\r\n                            const F = new FileReader();\r\n                            F.readAsArrayBuffer(f);\r\n                            return new Promise(resolve => {\r\n                                F.onload = function(){\r\n                                    resolve(F.result)\r\n                                };\r\n                            })\r\n                        }).then(bufAsArray => {\r\n                            return{\r\n                                default: ''\r\n                            }\r\n                        });\r\n                    }\r\n                }\r\n            };\r\n        }, \r\n        resetForm(formName) {\r\n            this.$refs[formName].resetFields();\r\n        },\r\n        initDeployDetial(){\r\n            let id = this.$route.params.id\r\n            this.$axios.get((this.$api.deployManage + '/' + id)).then((response) => {\r\n                this.deploy.title = response.data['res']['title']\r\n                this.deploy.category = response.data['res']['category']\r\n                this.deploy.version = response.data['res']['version']\r\n                this.deploy.post_author = response.data['res']['post_author']\r\n                this.deploy.deploy_uco = response.data['res']['deploy_uco']\r\n                this.deploy.deploy_uca = response.data['res']['deploy_uca']\r\n                this.deploy.deploy_ucs = response.data['res']['deploy_ucs']\r\n                this.deploy.deploy_sql = response.data['res']['deploy_sql']\r\n                this.deploy.deploy_links = response.data['res']['deploy_links']\r\n                this.deploy.environment = response.data['res']['environment_name']\r\n                this.deploy.deploy_describe = response.data['res']['deploy_describe']\r\n                this.deploy.body = response.data['res']['body']\r\n                this.deploy.api_task_id = response.data['res']['api_task_id']\r\n                this.deploy.api_test_report = response.data['res']['api_test_report']\r\n                this.deploy.timestamp = response.data['res']['timestamp']\r\n                this.fileList = response.data['fileList']\r\n            })\r\n        },\r\n        goBack(){\r\n            this.$router.go(-1);\r\n        },\r\n        beginDeploy(){\r\n            let post_id = this.$route.params.id\r\n            this.$axios.get((this.$api.postDeploy + post_id)).then((response) => {\r\n                this.$notify({\r\n                    title: '开始部署',\r\n                    message: '正在进行部署，部署完成后会有邮件通知',\r\n                    type: 'success',\r\n                })\r\n                this.messageShow(this, response);\r\n            }).catch((error) =>{\r\n                this.errorMessageShow(this, error.response);\r\n            })\r\n        },\r\n        getComments(){\r\n            let deploy_id = this.$route.params.id\r\n            this.$axios.get(this.$api.commentList.replace(/DEPLOY_ID/g, deploy_id),{\r\n                params: {page: 1, size: 100}\r\n            }).then(response => {\r\n                this.tableData = response.data['res']\r\n            })\r\n        },\r\n        addComment(){\r\n            this.dialog = true\r\n            this.commentForm.author = localStorage.getItem(\"name\")\r\n        },\r\n        commentDeploy(id){\r\n            this.$axios.get((this.$api.commentDeploy + id)).then((response) => {\r\n                this.$notify({\r\n                    title: '开始部署',\r\n                    message: '正在进行部署，部署完成后会有邮件通知',\r\n                    type: 'success',\r\n                })\r\n                this.messageShow(this, response);\r\n            }).catch((error) =>{\r\n                this.errorMessageShow(this, error.response);\r\n            })\r\n        },\r\n        deleteComment(id){\r\n            this.$axios.delete((this.$api.commentDelete + id)).then(response => {\r\n                if (this.messageShow(this, response)){\r\n                    this.reload();\r\n                }\r\n                }).catch((error) => {\r\n                this.errorMessageShow(this, error.response);\r\n                })\r\n        },\r\n        addCommentBtn(){\r\n            this.$confirm('确定要提交再次部署申请吗？')\r\n                .then(() => {\r\n                this.loading = true;\r\n                let deploy_id = this.$route.params.id\r\n                let data = {\r\n                    \"author\": this.commentForm.author,\r\n                    \"site\": this.commentForm.site,\r\n                    \"body\": this.commentForm.body,\r\n                    \"bug_id\": this.commentForm.bug_id,\r\n                    \"environment_id\": this.commentForm.environment_id\r\n                }\r\n                this.$axios.post(this.$api.commentAdd.replace(/DEPLOY_ID/g, deploy_id), data).then(response => {\r\n                    if (this.messageShow(this, response)){\r\n                        this.loading = false;\r\n                        this.dialog = false;\r\n                        this.reload();\r\n                    }\r\n                }).catch((error) => {\r\n                    this.loading = false;\r\n                    this.dialog = false;\r\n                    this.errorMessageShow(this, error.response);\r\n                })\r\n            })\r\n        },\r\n        downloadUrl(fileName){\r\n            let url = this.$api.fileDownload + 'report/' + fileName\r\n            return url \r\n        }\r\n    }\r\n}\r\n</script>\r\n\r\n<style>\r\n  .demo-table-expand {\r\n    font-size: 0;\r\n  }\r\n  .demo-table-expand label {\r\n    width: 80px;\r\n    color: #99a9bf;\r\n  }\r\n  .demo-table-expand .el-form-item {\r\n    margin-right: 0;\r\n    margin-bottom: 0;\r\n    width: 100%;\r\n  }\r\n  .el-drawer {\r\n    padding: 10px 10px 10px 10px;\r\n    position: absolute;\r\n    box-sizing: border-box;\r\n    background-color: #fff;\r\n    display: flex;\r\n    flex-direction: column;\r\n    box-shadow: 0 8px 10px -5px rgba(0,0,0,.2), 0 16px 24px 2px rgba(0,0,0,.14), 0 6px 30px 5px rgba(0,0,0,.12);\r\n    overflow: hidden;\r\n  }  \r\n  .demo-drawer__footer {\r\n      display: flex;\r\n  }\r\n</style>"],"sourceRoot":"src/components/deploy"}]}