{"remainingRequest":"D:\\workFiles\\deployweb\\node_modules\\babel-loader\\lib\\index.js!D:\\workFiles\\deployweb\\node_modules\\cache-loader\\dist\\cjs.js??ref--0-0!D:\\workFiles\\deployweb\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\workFiles\\deployweb\\src\\components\\qr\\RequireEdit.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\workFiles\\deployweb\\src\\components\\qr\\RequireEdit.vue","mtime":1583747397544},{"path":"D:\\workFiles\\deployweb\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\workFiles\\deployweb\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"D:\\workFiles\\deployweb\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\workFiles\\deployweb\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["import \"regenerator-runtime/runtime\";\nimport _asyncToGenerator from \"D:\\\\workFiles\\\\deployweb\\\\node_modules\\\\@babel\\\\runtime-corejs2/helpers/esm/asyncToGenerator\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport '@ckeditor/ckeditor5-build-decoupled-document/build/translations/zh-cn';\nimport DecoupledEditor from '@ckeditor/ckeditor5-build-decoupled-document'; // import func from '../../../vue-temp/vue-editor-bridge';\n\nexport default {\n  inject: ['reload'],\n  props: ['categorys'],\n  data: function data() {\n    return {\n      editor: DecoupledEditor,\n      editorConfig: {\n        language: 'zh-cn',\n        fontSize: {\n          options: [8, 10, 'default', 14, 16, 18, 20, 22, 24, 26, 28, 32, 48]\n        },\n        fontFamily: {\n          options: ['宋体', '仿宋', '微软雅黑', '黑体', '仿宋_GB2312', '楷体', '隶书', '幼圆']\n        }\n      },\n      users: [],\n      requireEditFlag: false,\n      requireEditId: '',\n      subHeader: '',\n      loading: false,\n      p_classes: [{\n        key: 'P1',\n        value: 'P1'\n      }, {\n        key: 'P2',\n        value: 'P2'\n      }, {\n        key: 'P3',\n        value: 'P3'\n      }, {\n        key: 'P4',\n        value: 'P4'\n      }],\n      record_types: [{\n        key: '环境需求',\n        value: '环境需求'\n      }, {\n        key: '物料需求',\n        value: '物料需求'\n      }, {\n        key: '其它',\n        value: '其它'\n      }],\n      requireForm: {\n        title: '',\n        category_id: '',\n        questioner: '',\n        p_class: '',\n        resolver: '',\n        body: '',\n        record_type: ''\n      },\n      rules: {\n        title: [{\n          required: true,\n          message: '请输入计划标题',\n          trigger: 'blur'\n        }, {\n          min: 3,\n          max: 60,\n          message: '长度在 3 到 60 个字符',\n          trigger: 'blur'\n        }],\n        category_id: [{\n          required: true,\n          message: '请选择所属项目',\n          trigger: 'change'\n        }],\n        p_class: [{\n          required: true,\n          message: '请选择需求级别',\n          trigger: 'blur'\n        }],\n        resolver: [{\n          required: true,\n          message: '请输入需求指派人',\n          trigger: 'blur'\n        }],\n        body: [{\n          required: true,\n          message: '请填写需求详细内容',\n          trigger: 'blur'\n        }],\n        record_type: [{\n          required: true,\n          message: '请选择需求类型',\n          trigger: 'blur'\n        }]\n      }\n    };\n  },\n  mounted: function mounted() {\n    this.judgeCreateOrEdit();\n    this.getAllUsers();\n  },\n  methods: {\n    initRequireFormEdit: function initRequireFormEdit(id) {\n      var _this = this;\n\n      this.$axios.get(this.$api.requireManage + '/' + id).then(function (response) {\n        _this.requireForm.title = response.data['res']['title'];\n        _this.requireForm.category_id = response.data['res']['category_id'];\n        _this.requireForm.p_class = response.data['res']['p_class'];\n        _this.requireForm.questioner = response.data['res']['questioner'];\n        _this.requireForm.resolver = response.data['res']['resolver'];\n        _this.requireForm.body = response.data['res']['body'];\n        _this.requireForm.record_type = response.data['res']['record_type'];\n      });\n    },\n    judgeCreateOrEdit: function judgeCreateOrEdit() {\n      if (this.$route.path.indexOf('edit') >= 0) {\n        this.requireEditFlag = true;\n        this.subHeader = '编辑需求';\n        this.requireEditId = this.$route.params.id;\n        this.initRequireFormEdit(this.requireEditId);\n      } else {\n        this.requireEditFlag = false;\n        this.subHeader = '新建需求';\n        this.requireForm.questioner = localStorage.getItem(\"name\");\n      }\n    },\n    goBack: function goBack() {\n      this.$router.go(-1);\n    },\n    editorOnReady: function editorOnReady(editor) {\n      editor.ui.getEditableElement().parentElement.insertBefore(editor.ui.view.toolbar.element, editor.ui.getEditableElement());\n\n      editor.plugins.get('FileRepository').createUploadAdapter = function (loader) {\n        var val = editor.getData();\n        return {\n          upload: function () {\n            var _upload = _asyncToGenerator(\n            /*#__PURE__*/\n            regeneratorRuntime.mark(function _callee() {\n              return regeneratorRuntime.wrap(function _callee$(_context) {\n                while (1) {\n                  switch (_context.prev = _context.next) {\n                    case 0:\n                      _context.next = 2;\n                      return loader.file.then(function (f) {\n                        var F = new FileReader();\n                        F.readAsArrayBuffer(f);\n                        return new Promise(function (resolve) {\n                          F.onload = function () {\n                            resolve(F.result);\n                          };\n                        });\n                      }).then(function (bufAsArray) {\n                        return {\n                          default: ''\n                        };\n                      });\n\n                    case 2:\n                      return _context.abrupt(\"return\", _context.sent);\n\n                    case 3:\n                    case \"end\":\n                      return _context.stop();\n                  }\n                }\n              }, _callee);\n            }));\n\n            function upload() {\n              return _upload.apply(this, arguments);\n            }\n\n            return upload;\n          }()\n        };\n      };\n    },\n    submitForm: function submitForm(formName) {\n      var _this2 = this;\n\n      this.loading = true;\n      this.$refs[formName].validate(function (valid) {\n        if (valid) {\n          var data = {\n            \"title\": _this2.requireForm.title,\n            \"category_id\": _this2.requireForm.category_id,\n            \"p_class\": _this2.requireForm.p_class,\n            \"questioner\": _this2.requireForm.questioner,\n            \"resolver\": _this2.requireForm.resolver,\n            \"body\": _this2.requireForm.body,\n            \"record_type\": _this2.requireForm.record_type\n          };\n\n          if (_this2.requireEditFlag === false) {\n            _this2.$axios.post(_this2.$api.requireManage, data).then(function (response) {\n              if (_this2.messageShow(_this2, response)) {\n                _this2.loading = false;\n\n                _this2.$router.push('/q_r/requires');\n\n                _this2.reload();\n              }\n            }).catch(function (error) {\n              _this2.errorMessageShow(_this2, error.response);\n            });\n          } else {\n            _this2.$axios.put(_this2.$api.requireManage + '/' + _this2.requireEditId, data).then(function (response) {\n              if (_this2.messageShow(_this2, response)) {\n                _this2.loading = false;\n\n                _this2.$router.push('/q_r/requires');\n\n                _this2.reload();\n              }\n            }).catch(function (error) {\n              _this2.errorMessageShow(_this2, error.response);\n            });\n          }\n        } else {\n          console.log('error submit!!');\n          return false;\n        }\n      });\n    },\n    resetForm: function resetForm(formName) {\n      this.$refs[formName].resetFields();\n    },\n    querySearch: function querySearch(queryString, cb) {\n      var users = this.users;\n      var results = queryString ? users.filter(this.createFilter(queryString)) : users;\n      cb(results);\n    },\n    createFilter: function createFilter(queryString) {\n      return function (user) {\n        return user.value.toLowerCase().indexOf(queryString.toLowerCase()) === 0;\n      };\n    },\n    getAllUsers: function getAllUsers() {\n      var _this3 = this;\n\n      this.$axios.get(this.$api.userList, {\n        params: {\n          page: 1,\n          size: 100\n        }\n      }).then(function (response) {\n        _this3.users = response.data['res'];\n      });\n    }\n  }\n};",{"version":3,"sources":["RequireEdit.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\r\n<div>\r\n    <el-page-header @back=\"goBack\" v-bind:content=\"subHeader\"></el-page-header>\r\n    <el-divider></el-divider>\r\n    <el-form :model=\"requireForm\" :rules=\"rules\" ref=\"requireForm\" label-width=\"150px\" class=\"demo-requireForm\" label-position=\"top\">\r\n        <el-form-item label=\"需求标题\" prop=\"title\" size=\"small\">\r\n            <el-input v-model=\"requireForm.title\" class=\"commonwidth\"></el-input>\r\n        </el-form-item>\r\n        <el-row :gutter=\"10\">\r\n          <el-col :span=\"4\">\r\n            <el-form-item label=\"提出者\" prop=\"questioner\" size=\"small\">\r\n                <el-input v-model=\"requireForm.questioner\" :disabled=\"true\"></el-input>\r\n            </el-form-item>\r\n          </el-col>\r\n          <el-col :span=\"4\">\r\n            <el-form-item label=\"项目\" prop=\"category_id\" size=\"small\">\r\n                <el-select v-model=\"requireForm.category_id\" placeholder=\"请选择项目\">\r\n                  <el-option\r\n                    v-for=\"item in categorys\"\r\n                    :key=\"item.id\"\r\n                    :label=\"item.name\"\r\n                    :value=\"item.id\">\r\n                  </el-option>\r\n                </el-select>\r\n            </el-form-item>\r\n          </el-col>\r\n          <el-col :span=\"4\">\r\n            <el-form-item label=\"级别\" prop=\"p_class\" size=\"small\">\r\n                <el-select v-model=\"requireForm.p_class\" placeholder=\"请选择需求级别\">\r\n                  <el-option\r\n                    v-for=\"item in p_classes\"\r\n                    :key=\"item.key\"\r\n                    :label=\"item.key\"\r\n                    :value=\"item.value\">\r\n                  </el-option>\r\n                </el-select>\r\n            </el-form-item>\r\n          </el-col>\r\n          <el-col :span=\"4\">\r\n            <el-form-item label=\"需求类型\" prop=\"record_type\" size=\"small\">\r\n                <el-select v-model=\"requireForm.record_type\" placeholder=\"请选择需求类型\">\r\n                  <el-option\r\n                    v-for=\"item in record_types\"\r\n                    :key=\"item.key\"\r\n                    :label=\"item.key\"\r\n                    :value=\"item.value\">\r\n                  </el-option>\r\n                </el-select>\r\n            </el-form-item>\r\n          </el-col>\r\n          <el-col :span=\"4\">\r\n            <el-form-item label=\"指派\" prop=\"resolver\" size=\"small\">\r\n                <!-- <el-input v-model=\"requireForm.resolver\"></el-input> -->\r\n                <el-autocomplete\r\n                  class=\"inline-input\"\r\n                  v-model=\"requireForm.resolver\"\r\n                  :fetch-suggestions=\"querySearch\"\r\n                  placeholder=\"请输入指派人员\"\r\n                  :trigger-on-focus=\"true\"\r\n                  >\r\n                </el-autocomplete>\r\n            </el-form-item>\r\n          </el-col>\r\n        </el-row>\r\n        <el-form-item label=\"详细内容\" prop=\"body\" size=\"small\">\r\n        <div  class=\"deploytext\">\r\n        <ckeditor :editor=\"editor\" @ready=\"editorOnReady\" v-model=\"requireForm.body\" :config=\"editorConfig\">\r\n        </ckeditor>\r\n        <el-divider></el-divider>\r\n        </div>\r\n        </el-form-item>\r\n        <el-form-item>\r\n            <el-button type=\"primary\" @click=\"submitForm('requireForm')\" :loading=\"loading\">{{ loading ? '提交中 ...' : '确 定' }}</el-button>\r\n            <el-button @click=\"resetForm('requireForm')\">重 置</el-button>\r\n        </el-form-item>\r\n    </el-form>\r\n</div>\r\n</template>\r\n\r\n<script>\r\nimport '@ckeditor/ckeditor5-build-decoupled-document/build/translations/zh-cn'\r\nimport DecoupledEditor from '@ckeditor/ckeditor5-build-decoupled-document'\r\n// import func from '../../../vue-temp/vue-editor-bridge';\r\n\r\n  export default {\r\n    inject: ['reload'],\r\n    props: ['categorys'],\r\n    data() {\r\n      return {\r\n        editor: DecoupledEditor,\r\n        editorConfig: {\r\n            language: 'zh-cn',\r\n            fontSize: {\r\n                options: [8, 10, 'default', 14, 16, 18, 20, 22, 24, 26, 28, 32, 48]\r\n            },\r\n            fontFamily:{\r\n                options: ['宋体', '仿宋', '微软雅黑', '黑体', '仿宋_GB2312', '楷体', '隶书', '幼圆']\r\n            }\r\n        },\r\n        users: [],\r\n        requireEditFlag: false,\r\n        requireEditId: '',\r\n        subHeader: '',\r\n        loading: false,\r\n        p_classes: [\r\n          {key: 'P1', value: 'P1'},\r\n          {key: 'P2', value: 'P2'},\r\n          {key: 'P3', value: 'P3'},\r\n          {key: 'P4', value: 'P4'}\r\n        ],\r\n        record_types: [\r\n          {key: '环境需求', value: '环境需求'},\r\n          {key: '物料需求', value: '物料需求'},\r\n          {key: '其它', value: '其它'}\r\n        ],\r\n        requireForm: {\r\n          title: '',\r\n          category_id: '',\r\n          questioner: '',\r\n          p_class: '',\r\n          resolver: '',\r\n          body: '',\r\n          record_type: ''\r\n        },\r\n        rules: {\r\n          title: [\r\n            { required: true, message: '请输入计划标题', trigger: 'blur' },\r\n            { min: 3, max: 60, message: '长度在 3 到 60 个字符', trigger: 'blur' }\r\n          ],\r\n          category_id: [\r\n            { required: true, message: '请选择所属项目', trigger: 'change' }\r\n          ],\r\n          p_class: [\r\n            { required: true, message: '请选择需求级别', trigger: 'blur' }\r\n          ],\r\n          resolver: [\r\n            { required: true, message: '请输入需求指派人', trigger: 'blur' }\r\n          ],\r\n          body: [\r\n            { required: true, message: '请填写需求详细内容', trigger: 'blur' }\r\n          ],\r\n          record_type: [\r\n            { required: true, message: '请选择需求类型', trigger: 'blur' }\r\n          ]\r\n        }\r\n      };\r\n    },\r\n    mounted() {\r\n      this.judgeCreateOrEdit();\r\n      this.getAllUsers();\r\n    },\r\n    methods: {\r\n        initRequireFormEdit(id){\r\n          this.$axios.get((this.$api.requireManage + '/' + id)).then((response) => {\r\n            this.requireForm.title = response.data['res']['title']\r\n            this.requireForm.category_id = response.data['res']['category_id']\r\n            this.requireForm.p_class = response.data['res']['p_class']\r\n            this.requireForm.questioner = response.data['res']['questioner']\r\n            this.requireForm.resolver = response.data['res']['resolver']\r\n            this.requireForm.body = response.data['res']['body']\r\n            this.requireForm.record_type = response.data['res']['record_type']\r\n          })\r\n        },\r\n        judgeCreateOrEdit(){\r\n            if(this.$route.path.indexOf('edit') >= 0){\r\n                this.requireEditFlag = true\r\n                this.subHeader = '编辑需求'\r\n                this.requireEditId = this.$route.params.id\r\n                this.initRequireFormEdit(this.requireEditId)\r\n            }else{\r\n                this.requireEditFlag = false\r\n                this.subHeader = '新建需求'\r\n                this.requireForm.questioner = localStorage.getItem(\"name\")\r\n            }\r\n        },\r\n        goBack(){\r\n            this.$router.go(-1);\r\n        },\r\n        editorOnReady(editor){\r\n            editor.ui.getEditableElement().parentElement.insertBefore(\r\n                editor.ui.view.toolbar.element,\r\n                editor.ui.getEditableElement()\r\n            );\r\n            editor.plugins.get('FileRepository').createUploadAdapter = function(loader){\r\n                let val = editor.getData();\r\n                return{\r\n                    upload: async function(){\r\n                        return await loader.file.then(f => {\r\n                            const F = new FileReader();\r\n                            F.readAsArrayBuffer(f);\r\n                            return new Promise(resolve => {\r\n                                F.onload = function(){\r\n                                    resolve(F.result)\r\n                                };\r\n                            })\r\n                        }).then(bufAsArray => {\r\n                            return{\r\n                                default: ''\r\n                            }\r\n                        });\r\n                    }\r\n                }\r\n            };\r\n        },\r\n      submitForm(formName) {\r\n        this.loading = true\r\n        this.$refs[formName].validate((valid) => {\r\n          if (valid) {\r\n            let data = {\r\n              \"title\": this.requireForm.title,\r\n              \"category_id\": this.requireForm.category_id,\r\n              \"p_class\": this.requireForm.p_class,\r\n              \"questioner\": this.requireForm.questioner,\r\n              \"resolver\": this.requireForm.resolver,\r\n              \"body\": this.requireForm.body,\r\n              \"record_type\": this.requireForm.record_type\r\n            }\r\n            if (this.requireEditFlag === false){\r\n              this.$axios.post(this.$api.requireManage, data).then((response) => {\r\n                if (this.messageShow(this, response)){\r\n                  this.loading = false\r\n                  this.$router.push('/q_r/requires')\r\n                  this.reload();\r\n                }\r\n              }).catch((error) => {\r\n                this.errorMessageShow(this, error.response);\r\n              })\r\n            }else{\r\n              this.$axios.put((this.$api.requireManage + '/' + this.requireEditId), data).then((response) => {\r\n                if (this.messageShow(this, response)){\r\n                  this.loading = false\r\n                  this.$router.push('/q_r/requires')\r\n                  this.reload();\r\n                }\r\n              }).catch((error) => {\r\n                this.errorMessageShow(this, error.response);\r\n              })\r\n            }\r\n          } else {\r\n            console.log('error submit!!');\r\n            return false;\r\n          }\r\n        });\r\n      },\r\n      resetForm(formName) {\r\n        this.$refs[formName].resetFields();\r\n      },\r\n      querySearch(queryString, cb) {\r\n        var users = this.users;\r\n        var results = queryString ? users.filter(this.createFilter(queryString)) : users;\r\n        cb(results);\r\n      },\r\n      createFilter(queryString) {\r\n        return (user) => {\r\n          return (user.value.toLowerCase().indexOf(queryString.toLowerCase()) === 0);\r\n        };\r\n      },\r\n      getAllUsers(){\r\n        this.$axios.get(this.$api.userList, \r\n        {\r\n          params: {page: 1, size: 100}\r\n        }).then((response) => {\r\n          this.users = response.data['res']\r\n        })\r\n      }\r\n    }\r\n  }\r\n</script>"],"sourceRoot":"src/components/qr"}]}